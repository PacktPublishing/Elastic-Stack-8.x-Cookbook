{
  "description": "Ingest pipeline created by text structure finder",
  "processors": [
    {
      "csv": {
        "field": "message",
        "target_fields": [
          "releaseyear",
          "title",
          "origin",
          "director",
          "cast",
          "genre",
          "wiki",
          "plot"
        ],
        "ignore_missing": false
      }
    },
    {
      "convert": {
        "field": "releaseyear",
        "type": "long",
        "ignore_missing": true
      }
    },
    {
      "inference": {
        "field_map": {
          "plot": "text_field"
        },
        "model_id": "sentence-transformers__all-distilroberta-v1",
        "target_field": "ml.inference.plot_vector",
        "on_failure": [
          {
            "append": {
              "field": "_source._ingest.inference_errors",
              "value": [
                {
                  "message": "Processor 'inference' in pipeline 'ml-inference-title-vector' failed with message '{{ _ingest.on_failure_message }}'",
                  "pipeline": "ml-inference-title-vector",
                  "timestamp": "{{{ _ingest.timestamp }}}"
                }
              ]
            }
          }
        ]
      }
    },
    {
      "set": {
        "field": "plot_vector",
        "if": "ctx?.ml?.inference != null && ctx.ml.inference['plot_vector'] != null",
        "copy_from": "ml.inference.plot_vector.predicted_value",
        "description": "Copy the predicted_value to 'plot_vector'"
      }
    },
    {
      "remove": {
        "field": "ml.inference.plot_vector",
        "ignore_missing": true
      }
    },
    {
      "remove": {
        "field": "message"
      }
    }
  ]
}